<style>
    body {
        min-width: 400px;
        overflow-x: hidden;
        font: 11px/1.4 tahoma, verdana, arial, sans-serif;
    }
    h1 {
        color: #273A47;
        font: bold 18px "Helvetica Neue",sans-serif;
        padding-bottom: 5px;
        border-bottom: 2px solid;
        margin-top: 1em;
    }
    h1:first-of-type {
        margin-top: 0;
    }
    table {
        width: 100%;
        border-spacing: 0;
    }
    td, th {
        font-size: 11px;
        padding: 0.5em;
    }
    th {
        color: #7E97A7;
        font-weight: normal;
    }
    tr td:nth-child(1) {
        width: 24px;
        text-align: center;
    }
    tr td:nth-child(2) {
        color: #2789CE;
    }
    tr td:nth-child(3),
    tr td:nth-child(4) {
        text-align: center;
        font-weight: bold;
    }
    tr td:nth-child(3) {
        color: #273A47;
    }
    tr td:nth-child(4) {
        color: #8FB600;
    }
    a {
        display: inline-block;
    }
    .heading {
        border-bottom: 1px solid #ccc;
        margin-bottom: 1em;
        font-size: 13px;
        font-weight: bold;
    }
    .button {
        color: #000;
        border: 1px solid;
        -webkit-border-radius: 3px;
        border-color: #BDCAD2;
        background: -webkit-gradient(linear,left top,left bottom,from(#F8FBFD),to(#E1EEF7));
        text-decoration: none;
        padding: 3px 10px 4px;
    }
    .button:hover {
        background: -webkit-gradient(linear,left top,left bottom,from(#D7ECFA),to(#BFE0F7));
    }
    #load img {
        vertical-align: middle;
        margin-right: 1.2em;
    }
</style>
<p id="load"><img src="http://sn2.cdnbf.net/page/images/loader_2337_.gif" alt="">Loading&hellip;</p>
<script>
    var req = new XMLHttpRequest(),
        req2 = new XMLHttpRequest();
    req.open(
        "GET",
        "http://beta.betfair.com/inplayservice/v1.0/eventsInPlay?"
        + "regionCode=UK&"
        + "alt=json&"
        + "locale=en_GB&"
        + "maxResults=100&"
        + "eventTypeIds=1&"
        + "ts=" + new Date().getTime(),
        true
    );
    req2.open(
        "GET",
        "http://beta.betfair.com/inplayservice/v1.0/eventsComingUp?"
        + "regionCode=UK&"
        + "alt=json&"
        + "locale=en_GB&"
        + "maxResults=100&"
        + "eventTypeIds=1&"
        + "ts=" + new Date().getTime(),
        true
    );
    req.send(null);
    req2.onload = showEvents;
    req2.send(null);

    function sortByDateAndEvent(a, b){
        x = new Date(a.startTime).getTime();
        y = new Date(b.startTime).getTime();
        if (x-y !== 0) {
            return x-y;
        } else {
            if (a.eventName > b.eventName) {
                return 1;
            } else if (a.eventName < b.eventName) {
                return -1;
            } else {
                return 0;
            }
        }
    }

    function showEvents() {
        var inPlayArray = JSON.parse(req.responseText)
                            .filter(function(i){
                                return i.marketId[0] === '1';
                            })
                            .slice(0, 9),
            comingUpArray = JSON.parse(req2.responseText),
            comingUpArray = comingUpArray.sort(sortByDateAndEvent)
                                .filter(function(i){
                                    return i.marketId[0] === '1';
                                })
                                .slice(0, 9 - (inPlayArray.length - 1)),
            elTbody1 = document.createElement('tbody'),
            elTbody2 = document.createElement('tbody'),
            elTable1 = document.createElement('table'),
            elTable2 = document.createElement('table'),
            elHeading1,
            elHeading2,
            days = [
                'Sunday',
                'Monday',
                'Tuesday',
                'Wednesday',
                'Thursday',
                'Friday',
                'Saturday'
            ],
            zeroFill = function(number, width) {
                width -= number.toString().length;
                return (width > 0) ?
                    new Array(
                        width
                        + (/\./.test(number) ? 2 : 1)
                    ).join('0') + number : number;
            };

        if (inPlayArray.length > 0) {
            elHeading1 = document.createElement('h1');
            elHeading1.innerHTML = 'In-play';
            document.body.appendChild(elHeading1);
            elTable1.innerHTML += [
                '<thead>',
                '<tr>',
                '<th scope="col">Betting</th>',
                '<th scope="col">Event</th>',
                '<th scope="col">Period</th>',
                '<th scope="col">Score</th>',
                '</tr>',
                '</thead>'
            ].join('');

            inPlayArray.forEach(function(val, idx){
                var state, score;
                if (val.state) {
                    switch(val.state.status) {
                        case "FirstHalfEnd":
                            state = "HT";
                            break;
                        case "SecondHalfEnd":
                            state = "FT";
                            break;
                        case "KickOff":
                        case "SecondHalfKickOff":
                        default:
                            state = val.state.timeElapsed + '&prime;';
                            break;
                    }
                    score = val.state.score.home.score + ' - '
                            + val.state.score.away.score;
                } else {
                    state = 'In-play';
                    score = '';
                }
                elTbody1.innerHTML += [
                    '<tr>',
                    '<td><a class="button" href="http://beta.betfair.com/event?id=' + val.eventId + '" target="_blank">Bet!</a></td>',
                    '<td>' + val.eventName + '</td>',
                    '<td>' + state + '</td>',
                    '<td>' + score + '</td>',
                    '</tr>'
                ].join('');
            });

            elTable1.appendChild(elTbody1);
            document.body.appendChild(elTable1);
        }

        if (comingUpArray.length > 0) {
            elHeading2 = document.createElement('h1');
            elHeading2.innerHTML = 'Coming up';
            document.body.appendChild(elHeading2);
            elTable2.innerHTML += [
                '<thead>',
                '<tr>',
                '<th scope="col">Betting</th>',
                '<th scope="col">Event</th>',
                '<th scope="col">When</th>',
                '</tr>',
                '</thead>'
            ].join('');

            comingUpArray.forEach(function(val, idx){
                var start = new Date(val.startTime),
                    now = new Date(),
                    displayDate = [
                        zeroFill(start.getHours(), 2),
                        ':',
                        zeroFill(start.getMinutes(), 2)
                    ].join(''),
                    displayDate = (start.getDay() === now.getDay()) ? displayDate : days[start.getDay()] + ' ' + displayDate;

                elTbody2.innerHTML += [
                    '<tr>',
                    '<td><a class="button" href="http://beta.betfair.com/event?id=' + val.eventId + '" target="_blank">Bet!</a></td>',
                    '<td>' + val.eventName + '</td>',
                    '<td>' + displayDate + '</td>',
                    '</tr>'
                ].join('');
            });

            elTable2.appendChild(elTbody2);
            document.body.appendChild(elTable2);
        }

        document.body.removeChild(document.getElementById("load"));
    }
</script>
